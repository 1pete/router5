!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.router5BrowserPlugin=t()}(this,function(){"use strict";function e(e,t){function a(e){var a=e.match(/^(?:http|https):\/\/(?:[0-9a-z_\-.:]+?)(?=\/)(.*)$/),n=(a?a[1]:e).match(/^(.+?)(#.+?)?(\?.+)?$/);if(!n)throw new Error("[router5] Could not parse url "+e);var r=n[1],o=n[2]||"",i=n[3]||"";return(t.useHash?o.replace(new RegExp("^#"+t.hashPrefix),""):t.base?r.replace(new RegExp("^"+t.base),""):r)+i}e.urlToPath=a,e.buildUrl=function(a,n){var r=t.base||"",o=t.useHash?"#"+t.hashPrefix:"",i=e.buildPath(a,n);return null===i?null:r+o+i},e.matchUrl=function(t){return e.matchPath(a(t))}}var t={ROUTER_NOT_STARTED:"NOT_STARTED",NO_START_PATH_OR_STATE:"NO_START_PATH_OR_STATE",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",TRANSITION_CANCELLED:"CANCELLED"},a={UNKNOWN_ROUTE:"@@router5/UNKNOWN_ROUTE",ROUTER_START:"$start",ROUTER_STOP:"$stop",TRANSITION_START:"$$start",TRANSITION_CANCEL:"$$cancel",TRANSITION_SUCCESS:"$$success",TRANSITION_ERROR:"$$error"},n=function(e){return function(){return e}},r=function(){},o=function(){return-1===window.navigator.userAgent.indexOf("Trident")},i={},s=i="undefined"!=typeof window&&window.history?{getBase:function(){return window.location.pathname.replace(/\/$/,"")},pushState:function(e,t,a){return window.history.pushState(e,t,a)},replaceState:function(e,t,a){return window.history.replaceState(e,t,a)},addPopstateListener:function(e){window.addEventListener("popstate",e),o()||window.addEventListeners("hashchange",e)},removePopstateListener:function(e){window.removeEventListener("popstate",e),o()||window.removeEventListener("hashchange",e)},getLocation:function(e){return((e.useHash?window.location.hash.replace(new RegExp("^#"+e.hashPrefix),""):window.location.pathname.replace(new RegExp("^"+e.base),""))||"/")+window.location.search},getState:function(){return window.history.state},getHash:function(){return window.location.hash}}:{getBase:n(""),pushState:r,replaceState:r,addPopstateListener:r,removePopstateListener:r,getLocation:n(""),getState:n(null),getHash:n("")},u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},c={forceDeactivate:!0,useHash:!1,hashPrefix:"",base:!1,mergeState:!1,preserveHash:!0},T="popstate";return function(){function n(n){function r(e,t,a){var n=e?{meta:e.meta,name:e.name,params:e.params,path:e.path}:e,r=!0===i.mergeState?u({},o.getState(),n):n;a?o.replaceState(r,"",t):o.pushState(r,"",t)}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=n.getState(),l=!e.state||!e.state.name,h=l?n.matchPath(o.getLocation(i),T):n.makeState(e.state.name,e.state.params,e.state.path,u({},e.state.meta,{source:T}),e.state.meta.id),d=c.defaultRoute,f=c.defaultParams;h?s&&n.areStatesEqual(h,s,!1)||n.transitionToState(h,s,p,function(e,o){if(e)if(e.redirect){var i=e.redirect,c=i.name,T=i.params;n.navigate(c,T,u({},p,{replace:!0,force:!0,redirected:!0}))}else if(e.code===t.CANNOT_DEACTIVATE){var S=n.buildUrl(s.name,s.params);l||r(h,S,!0)}else d&&n.navigate(d,f,u({},p,{reload:!0,replace:!0}));else n.invokeEventListeners(a.TRANSITION_SUCCESS,o,s,{replace:!0})}):d&&n.navigateToDefault(u({},p,{reload:!0,replace:!0}))}var c=n.getOptions(),l=n.start;return e(n,i),n.start=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return 0===t.length||"function"==typeof t[0]?l.apply(void 0,[o.getLocation(i)].concat(t)):l.apply(void 0,t),n},n.replaceHistoryState=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.buildState(e,t),r=n.buildUrl(e,t);n.lastKnownState=a,o.replaceState(a,"",r)},{onStart:function(){i.useHash&&!i.base&&(i.base=o.getBase()),o.addPopstateListener(s)},onStop:function(){o.removePopstateListener(s)},onTransitionSuccess:function(e,t,a){var s=o.getState(),u=s&&s.meta&&s.name&&s.params,c=t&&n.areStatesEqual(t,e,!1),T=a.replace||!u||c,p=n.buildUrl(e.name,e.params);null===t&&!1===i.useHash&&!0===i.preserveHash&&(p+=o.getHash()),r(e,p,T)},onPopState:s}}var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s,i=u({},c,r),p={forceDeactivate:i.forceDeactivate,source:T};return n.pluginName="BROWSER_PLUGIN",n}});
