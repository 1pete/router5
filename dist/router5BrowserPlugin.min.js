!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.router5BrowserPlugin=t()}(this,function(){"use strict";function e(e,t){function a(a,n){return(t.base||"")+(t.useHash?"#"+t.hashPrefix:"")+e.buildPath(a,n)}function n(e){var a=e.match(/^(?:http|https)\:\/\/(?:[0-9a-z_\-\.\:]+?)(?=\/)(.*)$/),n=a?a[1]:e,r=n.match(/^(.+?)(#.+?)?(\?.+)?$/);if(!r)throw new Error("[router5] Could not parse url "+e);var o=r[1],i=r[2]||"",s=r[3]||"";return(t.useHash?i.replace(new RegExp("^#"+t.hashPrefix),""):t.base?o.replace(new RegExp("^"+t.base),""):o)+s}function r(t){return e.matchPath(n(t))}e.urlToPath=n,e.buildUrl=a,e.matchUrl=r}function t(){function t(t){function r(e,t,a){var n=e?{meta:e.meta,name:e.name,params:e.params,path:e.path}:e,r=!0===i.mergeState?E({},o.getState(),n):n;a?o.replaceState(r,"",t):o.pushState(r,"",t)}function u(e){var u=t.getState(),c=!e.state||!e.state.name,T=c?t.matchPath(o.getLocation(i),R):e.state,p=l.defaultRoute,S=l.defaultParams;if(!T)return void(p&&t.navigateToDefault(E({},s,{reload:!0,replace:!0})));u&&t.areStatesEqual(T,u,!1)||t.transitionToState(T,u,s,function(e,o){if(e)if(e.redirect){var i=e.redirect,l=i.name,f=i.params;t.navigate(l,f,E({},s,{replace:!0}))}else if(e===a.CANNOT_DEACTIVATE){var h=t.buildUrl(u.name,u.params);c||r(T,h,!0)}else p&&t.navigate(p,S,E({},s,{reload:!0,replace:!0}));else t.invokeEventListeners(n.TRANSITION_SUCCESS,o,u,{replace:!0})})}function c(){i.useHash&&!i.base&&(i.base=o.getBase()),o.addPopstateListener(u)}function T(){o.removePopstateListener(u)}function p(e,a,n){var s=o.getState(),u=n.replace||a&&t.areStatesEqual(e,a,!1)||n.reload&&s&&t.areStatesEqual(e,s,!1),c=t.buildUrl(e.name,e.params);null===a&&!0===i.preserveHash&&(c+=o.getHash()),r(e,c,u)}var l=t.getOptions(),S=t.start;return e(t,i),t.start=function(){for(var e=arguments.length,a=Array(e),n=0;n<e;n++)a[n]=arguments[n];return 0===a.length||"function"==typeof a[0]?S.apply(void 0,[o.getLocation(i)].concat(a)):S.apply(void 0,a),t},t.replaceHistoryState=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.buildState(e,a),r=t.buildUrl(e,a);t.lastKnownState=n,o.replaceState(n,"",r)},{onStart:c,onStop:T,onTransitionSuccess:p,onPopState:u}}var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d,i=E({},A,r),s={forceDeactivate:i.forceDeactivate,source:R};return t.pluginName="BROWSER_PLUGIN",t}var a={ROUTER_NOT_STARTED:"NOT_STARTED",NO_START_PATH_OR_STATE:"NO_START_PATH_OR_STATE",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",TRANSITION_CANCELLED:"CANCELLED"},n={UNKNOWN_ROUTE:"@@router5/UNKNOWN_ROUTE",ROUTER_START:"$start",ROUTER_STOP:"$stop",TRANSITION_START:"$$start",TRANSITION_CANCEL:"$$cancel",TRANSITION_SUCCESS:"$$success",TRANSITION_ERROR:"$$error"},r=function(e){return function(){return e}},o=function(){},i="undefined"!=typeof window&&window.history,s=function(){return window.location.pathname.replace(/\/$/,"")},u=function(e,t,a){return window.history.pushState(e,t,a)},c=function(e,t,a){return window.history.replaceState(e,t,a)},T=function(e){return window.addEventListener("popstate",e)},p=function(e){return window.removeEventListener("popstate",e)},l=function(e){return((e.useHash?window.location.hash.replace(new RegExp("^#"+e.hashPrefix),""):window.location.pathname.replace(new RegExp("^"+e.base),""))||"/")+window.location.search},S=function(){return window.history.state},f=function(){return window.location.hash},h={};h=i?{getBase:s,pushState:u,replaceState:c,addPopstateListener:T,removePopstateListener:p,getLocation:l,getState:S,getHash:f}:{getBase:r(""),pushState:o,replaceState:o,addPopstateListener:o,removePopstateListener:o,getLocation:r(""),getState:r(null),getHash:r("")};var d=h,E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},A={forceDeactivate:!0,useHash:!1,hashPrefix:"",base:!1,mergeState:!1,preserveHash:!1},R="popstate";return t});
