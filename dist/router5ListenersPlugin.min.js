!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.router5ListenersPlugin=n()}(this,function(){"use strict";function e(e){return e.split(".").reduce(function(e,n){return e.concat(e.length?e[e.length-1]+"."+n:n)},[])}function n(e){return void 0!==e&&null!==e}function t(e){return e&&e.meta&&e.meta.params}function r(e,t){return n(t.meta.params[e])?Object.keys(t.meta.params[e]).reduce(function(e,n){return e[n]=t.params[n],e},{}):{}}function o(n,o){var i=o?e(o.name):[],c=e(n.name),a=Math.min(i.length,c.length),f=void 0;o?t(o)||t(n)?f=function(){var e=void 0;for(e=0;e<a;e+=1){var t=function(){var t=i[e],u=c[e];if(t!==u)return{v:e};var a=r(t,n),f=r(u,o);return a.length!==f.length?{v:e}:0===a.length?"continue":Object.keys(a).some(function(e){return f[e]!==a[e]})?{v:e}:void 0}();switch(t){case"continue":continue;default:if("object"===(void 0===t?"undefined":u(t)))return t.v}}return e}():(console.warn("[router5.transition-path] Some states are missing metadata, reloading all segments"),f=0):f=0;var s=i.slice(f).reverse(),l=c.slice(f);return{intersection:o&&f>0?i[f-1]:"",toDeactivate:s,toActivate:l}}function i(){function e(e){function t(n,t){return t?c[n]&&(c[n]=c[n].filter(function(e){return e!==t})):c[n]=[],e}function r(n,t,r){var o=n.replace(/^(\*|\^|=)/,"");if(o&&!/^\$/.test(n)){e.rootNode.getSegmentsByName(o)||console.warn("No route found for "+o+", listener might never be called!")}return c[n]||(c[n]=[]),c[n]=(r?[]:c[n]).concat(t),e}function i(e,n,t){(c[e]||[]).forEach(function(r){-1!==c[e].indexOf(r)&&r(n,t)})}function u(e,r,u){var c=o(e,r),a=c.intersection,f=c.toDeactivate,s=u.reload?"":a,l=e.name;n.autoCleanUp&&f.forEach(function(e){return t("^"+e)}),i("^"+s,e,r),i("="+l,e,r),i("*",e,r)}var c={};return e.getListeners=function(){return c},e.addListener=function(e){return r("*",e)},e.removeListener=function(e){return t("*",e)},e.addNodeListener=function(e,n){return r("^"+e,n,!0)},e.removeNodeListener=function(e,n){return t("^"+e,n)},e.addRouteListener=function(e,n){return r("="+e,n)},e.removeRouteListener=function(e,n){return t("="+e,n)},{onTransitionSuccess:u}}var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;return e.pluginName="LISTENERS_PLUGIN",e}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c={autoCleanUp:!0};return i});
