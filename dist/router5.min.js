!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.router5=e.router5||{})}(this,function(e){"use strict";function t(e){function t(t,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t.name!==n.name)return!1;var a=function(t){return e.rootNode.getSegmentsByName(t).map(function(e){return e.parser.urlParams}).reduce(function(e,t){return e.concat(t)},[])},o=r?a(t.name):Object.keys(t.params),i=r?a(n.name):Object.keys(n.params);return o.length===i.length&&o.every(function(e){return t.params[e]===n.params[e]})}function n(e,t){return!!new RegExp("^"+e.name+"\\.(.*)$").test(t.name)&&Object.keys(e.params).every(function(n){return e.params[n]===t.params[n]})}function r(t,n){var r=e.config.forwardMap[t]||t;return{name:r,params:Q({},e.config.defaultParams[t],e.config.defaultParams[r],n)}}e.isActive=function(r){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],u=e.getState();return!!u&&(o||u.name===r?t(e.makeState(r,a),u,i):n(e.makeState(r,a),u))},e.areStatesEqual=t,e.areStatesDescendants=n,e.buildPath=function(t,n){if(t===ae.UNKNOWN_ROUTE)return n.path;var r=e.getOptions(),a=r.trailingSlashMode,o=r.queryParamsMode,i=r.queryParams,u=e.config.encoders[t]?e.config.encoders[t](n):n;return e.rootNode.buildPath(t,u,{trailingSlashMode:a,queryParamsMode:o,queryParams:i})},e.buildState=function(t,n){var a=r(t,n),o=a.name,i=a.params;return e.rootNode.buildState(o,i)},e.matchPath=function(t,n){var a=e.getOptions(),o=e.rootNode.matchPath(t,a);if(o){var i=o.name,u=o.params,s=o.meta,c=r(i,e.config.decoders[i]?e.config.decoders[i](u):u),l=c.name,f=c.params,d=!1===a.rewritePathOnMatch?t:e.buildPath(l,f);return e.makeState(l,f,d,{params:s,source:n})}return null},e.setRootPath=function(t){e.rootNode.setPath(t)}}function n(e){var t=!1;e.isStarted=function(){return t},e.start=function(){var n,r=e.getOptions(),a=(n=arguments.length-1,arguments.length<=n?void 0:arguments[n]),o="function"==typeof a?a:oe,i="function"!=typeof(arguments.length<=0?void 0:arguments[0])?arguments.length<=0?void 0:arguments[0]:void 0;if(t)return o({code:re.ROUTER_ALREADY_STARTED}),e;var u=void 0,s=void 0;t=!0,e.invokeEventListeners(ae.ROUTER_START);var c=function(t,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t||e.invokeEventListeners(ae.TRANSITION_SUCCESS,n,null,{replace:!0}),t&&r&&e.invokeEventListeners(ae.TRANSITION_ERROR,n,null,t),o(t,n)};if(void 0===i&&!r.defaultRoute)return c({code:re.NO_START_PATH_OR_STATE});if("string"==typeof i?u=i:"object"===(void 0===i?"undefined":z(i))&&(s=i),s)e.setState(s),c(null,s);else{var l=function(){return e.navigateToDefault({replace:!0},o)},f=function(t){return e.navigate(t.name,t.params,{replace:!0,reload:!0,redirected:!0},o)},d=function(t){e.transitionToState(t,e.getState(),{},function(e,t){e?e.redirect?f(e.redirect):r.defaultRoute?l():c(e,null,!1):c(null,t)})};(s=void 0===u?null:e.matchPath(u))?d(s):r.defaultRoute?l():r.allowNotFound?d(e.makeNotFoundState(u,{replace:!0})):c({code:re.ROUTE_NOT_FOUND,path:u},null)}return e},e.stop=function(){return t&&(e.setState(null),t=!1,e.invokeEventListeners(ae.ROUTER_STOP)),e}}function r(e){return e.split(".").reduce(function(e,t){return e.concat(e.length?e[e.length-1]+"."+t:t)},[])}function a(e){return void 0!==e&&null!==e}function o(e){return e&&e.meta&&e.meta.params}function i(e,t){return a(t.meta.params[e])?Object.keys(t.meta.params[e]).reduce(function(e,n){return e[n]=t.params[n],e},{}):{}}function u(e,t){var n=t?r(t.name):[],a=r(e.name),u=Math.min(n.length,a.length),s=void 0;t?o(t)||o(e)?s=function(){var r=void 0;for(r=0;r<u;r+=1){var o=function(){var o=n[r],u=a[r];if(o!==u)return{v:r};var s=i(o,e),c=i(u,t);return s.length!==c.length?{v:r}:0===s.length?"continue":Object.keys(s).some(function(e){return c[e]!==s[e]})?{v:r}:void 0}();switch(o){case"continue":continue;default:if("object"===(void 0===o?"undefined":ie(o)))return o.v}}return r}():(console.warn("[router5-transition-path] Some states are missing metadata, reloading all segments"),s=0):s=0;var c=n.slice(s).reverse(),l=a.slice(s);return{intersection:t&&s>0?n[s-1]:"",toDeactivate:c,toActivate:l}}function s(e,t,n){var r=t.isCancelled,a=t.toState,o=t.fromState,i=t.errorKey,u=Array.isArray(e)?e:Object.keys(e),s=function(e){return"object"===(void 0===e?"undefined":z(e))&&void 0!==e.name&&void 0!==e.params&&void 0!==e.path},c=function(e,t){return t.name!==e.name||t.params!==e.params||t.path!==e.path},l=function(e,t){return Q({},t,e,{meta:Q({},t.meta,e.meta)})},f=function(e,t,n,a){var i=function(e,t){e?a(e):t&&t!==n&&s(t)?(c(t,n)&&console.error("[router5][transition] Warning: state values (name, params, path) were changed during transition process."),a(null,l(t,n))):a(null,n)},u=e.call(null,n,o,i);r()?i(null):"boolean"==typeof u?i(u?null:t):s(u)?i(null,u):u&&"function"==typeof u.then&&u.then(function(e){e instanceof Error?i({error:e},null):i(null,e)},function(e){e instanceof Error?(console.error(e.stack||e),i(Q({},t,{promiseError:e}),null)):i("object"===(void 0===e?"undefined":z(e))?Q({},t,e):t,null)})};!function t(a,o){if(r())n();else if(a)n(a);else if(u.length){var s="string"==typeof u[0],c=i&&s?B({},i,u[0]):{},l=s?e[u[0]]:u[0];u=u.slice(1),f(l,c,o,t)}else n(null,o)}(null,a)}function c(e,t,n,a,o){var i=!1,c=!1,l=e.getOptions(),f=e.getLifecycleFunctions(),d=Z(f,2),p=d[0],h=d[1],m=e.getMiddlewareFunctions(),v=function(){return i},g=function(e,t){return Q({},e,t instanceof Object?t:{error:t})},y=t.name===ae.UNKNOWN_ROUTE,T={isCancelled:v,toState:t,fromState:n},S=u(t,n),O=S.toDeactivate,P=S.toActivate,E=!n||a.forceDeactivate?[]:function(e,t,n){s(O.filter(function(e){return p[e]}).reduce(function(e,t){return Q({},e,B({},t,p[t]))},{}),Q({},T,{errorKey:"segment"}),function(e){return n(e?g({code:re.CANNOT_DEACTIVATE},e):null)})},N=y?[]:function(e,t,n){s(P.filter(function(e){return h[e]}).reduce(function(e,t){return Q({},e,B({},t,h[t]))},{}),Q({},T,{errorKey:"segment"}),function(e){return n(e?g({code:re.CANNOT_ACTIVATE},e):null)})},A=m.length?function(e,t,n){return s(m,Q({},T),function(t,r){return n(t?g({code:re.TRANSITION_ERR},t):null,r||e)})}:[];return s([].concat(E).concat(N).concat(A),T,function(n,a){if(c=!0,!v()){if(!n&&l.autoCleanUp){var i=r(t.name);Object.keys(p).forEach(function(t){-1===i.indexOf(t)&&e.clearCanDeactivate(t)})}o(n,a||t)}}),function(){i||c||(i=!0,o({code:re.TRANSITION_CANCELLED},null))}}function l(e){function t(){return a&&(a("navigate"),a=null),e}function n(){var t,a=arguments.length<=0?void 0:arguments[0],o=(t=arguments.length-1,arguments.length<=t?void 0:arguments[t]),i="function"==typeof o?o:ue,u="object"===z(arguments.length<=1?void 0:arguments[1])?arguments.length<=1?void 0:arguments[1]:{},s="object"===z(arguments.length<=2?void 0:arguments[2])?arguments.length<=2?void 0:arguments[2]:{};if(e.isStarted()){var c=e.buildState(a,u);if(!c){var l={code:re.ROUTE_NOT_FOUND};return i(l),void e.invokeEventListeners(ae.TRANSITION_ERROR,null,e.getState(),l)}var f=e.makeState(c.name,c.params,e.buildPath(c.name,c.params),{params:c.meta,options:s}),d=!!e.getState()&&e.areStatesEqual(e.getState(),f,!1);if(d&&!s.reload&&!s.force){var p={code:re.SAME_STATES};return i(p),void e.invokeEventListeners(ae.TRANSITION_ERROR,f,e.getState(),p)}var h=d||s.reload?null:e.getState();return s.skipTransition?(i(null,f),ue):r(f,h,s,function(t,r){if(t)if(t.redirect){var a=t.redirect;n(a.name,a.params,Q({},s,{force:!0,redirected:!0}),i)}else i(t);else e.invokeEventListeners(ae.TRANSITION_SUCCESS,r,h,s),i(null,r)})}i({code:re.ROUTER_NOT_STARTED})}function r(n,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ue;return t(),e.invokeEventListeners(ae.TRANSITION_START,n,r),a=c(e,n,r,o,function(t,o){a=null,o=o||n,t?(t.code===re.TRANSITION_CANCELLED?e.invokeEventListeners(ae.TRANSITION_CANCEL,n,r):e.invokeEventListeners(ae.TRANSITION_ERROR,n,r,t),i(t)):(e.setState(o),i(null,o))})}var a=void 0;e.config.forwardMap={},e.navigate=n,e.navigateToDefault=function(){var t="object"===z(arguments.length<=0?void 0:arguments[0])?arguments.length<=0?void 0:arguments[0]:{},r=2===arguments.length?arguments.length<=1?void 0:arguments[1]:"function"==typeof(arguments.length<=0?void 0:arguments[0])?arguments.length<=0?void 0:arguments[0]:ue,a=e.getOptions();return a.defaultRoute?n(a.defaultRoute,a.defaultParams,t,r):function(){}},e.transitionToState=r,e.cancel=t,e.forward=function(t,n){return e.config.forwardMap[t]=n,e}}function f(e){function t(t){n.push(t),r.push(e.executeFactory(t))}var n=[],r=[];e.useMiddleware=function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];return r.forEach(t),e},e.getMiddlewareFactories=function(){return n},e.getMiddlewareFunctions=function(){return r},e.clearMiddleware=function(){return n=[],r=[],e}}function d(e){function t(e){n(e)||(a.push(e),r(e))}function n(e){return a.filter(function(t){return t.pluginName===e||t.name===e}).length>0}function r(t){var n=e.executeFactory(t),r=se.map(function(t){if(n[t])return e.addEventListener(t.toLowerCase().replace(/^on/,"$$").replace(/transition/,"$$"),n[t])}).filter(Boolean);o.push.apply(o,K(r))}var a=[],o=[];e.usePlugin=function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];return r.forEach(t),e},e.hasPlugin=n,e.getPlugins=function(){return a}}function p(e){var t={},n={},r={},a={};e.canDeactivate=function(n,a){var o=ce(a);return t[n]=o,r[n]=e.executeFactory(o),e},e.canActivate=function(t,r){var o=ce(r);return n[t]=o,a[t]=e.executeFactory(o),e},e.getLifecycleFactories=function(){return[t,n]},e.getLifecycleFunctions=function(){return[r,a]},e.clearCanDeactivate=function(n){return t[n]=void 0,r[n]=void 0,e}}function h(e,t){e.clone=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Q({},e.getDependencies(),n),a=t(e.rootNode,e.getOptions(),r);a.useMiddleware.apply(a,K(e.getMiddlewareFactories())),a.usePlugin.apply(a,K(e.getPlugins())),a.config=e.config;var o=e.getLifecycleFactories(),i=Z(o,2),u=i[0],s=i[1];return Object.keys(u).forEach(function(e){return a.canDeactivate(e,u[e])}),Object.keys(s).forEach(function(e){return a.canActivate(e,s[e])}),a}}function m(e){function r(e,t){y[e]=y[e].filter(function(e){return e!==t})}function a(e){e.canActivate&&O.canActivate(e.name,e.canActivate),e.forwardTo&&O.forward(e.name,e.forwardTo),e.decodeParams&&(O.config.decoders[e.name]=e.decodeParams),e.encodeParams&&(O.config.encoders[e.name]=e.encodeParams),e.defaultParams&&(O.config.defaultParams[e.name]=e.defaultParams)}function o(e,t,n,r,a){var o={},i=function(e,t){return Object.defineProperty(o,e,{value:t,enumerable:!0})};if(i("name",e),i("params",t),i("path",n),r){var u=void 0;u=void 0===a?g+=1:a,i("meta",Q({},r,{id:u}))}return o}function i(e,t){return S[e]=t,O}function u(){return T}function s(){return[O,u()]}var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=null,g=0,y={},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},S=Q({},le);Object.keys(c).forEach(function(e){return i(e,c[e])});var O={config:{decoders:{},encoders:{},defaultParams:{}},rootNode:P,getOptions:function(){return S},setOption:i,getState:function(){return v},setState:function(e){v=e,e&&e.meta&&"number"==typeof e.meta.id&&(g=e.meta.id)},makeState:o,makeNotFoundState:function(e,t){return o(ae.UNKNOWN_ROUTE,{path:e},e,{options:t})},setDependency:function(e,t){return T[e]=t,O},setDependencies:function(e){return Object.keys(e).forEach(function(t){T[t]=e[t]}),O},getDependencies:u,add:function(e){return P.add(e,a),O},addNode:function(e,t,n){return O.rootNode.addNode(e,t),n&&O.canActivate(e,n),O},executeFactory:function(e){return e.apply(void 0,K(s()))},addEventListener:function(e,t){return y[e]=(y[e]||[]).concat(t),function(){return r(e,t)}},removeEventListener:r,invokeEventListeners:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];(y[e]||[]).forEach(function(e){return e.apply(void 0,n)})}};t(O),d(O),f(O),p(O),n(O),l(O),h(O,m);var P=e instanceof ne?e:new ne("","",e,a);return O.rootNode=P,O}function v(){var e=void 0,t=void 0;return console.groupCollapsed?(e=function(e){return console.groupCollapsed(e)},t=function(){return console.groupEnd()}):console.group?(e=function(e){return console.group(e)},t=function(){return console.groupEnd()}):(e=fe,t=fe),console.info("Router started"),{onStop:function(){console.info("Router stopped")},onTransitionStart:function(n,r){t(),e("Router transition"),console.log("Transition started from state"),console.log(r),console.log("To state"),console.log(n)},onTransitionCancel:function(){console.warn("Transition cancelled")},onTransitionError:function(e,n,r){console.warn("Transition error with code "+r.code),t()},onTransitionSuccess:function(){console.log("Transition success"),t()}}}var g=function(e){return void 0===e&&(e={}),{arrayFormat:e.arrayFormat||"none",booleanFormat:e.booleanFormat||"none",nullFormat:e.nullFormat||"default"}},y=function(e){return encodeURIComponent(e)},T=function(e){return decodeURIComponent(e)},S=function(e,t,n){if("empty-true"===n.booleanFormat&&t)return e;var r;return r="unicode"===n.booleanFormat?t?"✓":"✗":t.toString(),e+"="+r},O=function(e,t){return"hidden"===t.nullFormat?"":"string"===t.nullFormat?e+"=null":e},P=function(e){return"index"===e.arrayFormat?function(e,t){return e+"["+t+"]"}:"brackets"===e.arrayFormat?function(e){return e+"[]"}:function(e){return e}},E=function(e,t,n){var r=P(n);return t.map(function(t,n){return r(e,n)+"="+y(t)}).join("&")},N=function(e,t,n){return null===t?O(e,n):"boolean"==typeof t?S(e,t,n):Array.isArray(t)?E(e,t,n):e+"="+y(t)},A=function(e,t){if(void 0===e)return"empty-true"===t.booleanFormat||null;if("string"===t.booleanFormat){if("true"===e)return!0;if("false"===e)return!1}else if("unicode"===t.booleanFormat){if("✓"===e)return!0;if("✗"===e)return!1}else if("string"===t.nullFormat&&"null"===e)return null;return T(e)},R=function(e){var t=e.indexOf("?");return-1===t?e:e.slice(t+1)},b=function(e){return void 0!==e},_=function(e){var t=e.indexOf("["),n=-1!==t;return{hasBrackets:n,name:n?e.slice(0,t):e}},w=function(e,t){var n=g(t);return R(e).split("&").reduce(function(e,t){var r=t.split("="),a=r[0],o=r[1],i=_(a),u=i.hasBrackets,s=i.name,c=e[s],l=A(o,n);return e[s]=void 0===c?u?[l]:l:[].concat(c,l),e},{})},C=function(e,t){var n=g(t);return Object.keys(e).filter(function(t){return b(e[t])}).map(function(t){return N(t,e[t],n)}).filter(Boolean).join("&")},k=function(e,t,n){var r=g(n);if(""===R(e))return{querystring:"",removedParams:{}};var a=e.split("&").reduce(function(e,n){var r=e[0],a=e[1],o=n.split("=")[0],i=_(o).name;return-1===t.indexOf(i)?[r.concat(n),a]:[r,a.concat(n)]},[[],[]]),o=a[0],i=a[1];return{querystring:o.join("&"),removedParams:w(i.join("&"),r)}},j=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},x=function(e){return"("+(e?e.replace(/(^<|>$)/g,""):"[a-zA-Z0-9-_.~%':]+")+")"},I=[{name:"url-parameter",pattern:/^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(x(e[2]))}},{name:"url-parameter-splat",pattern:/^\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,regex:/([^?]*)/},{name:"url-parameter-matrix",pattern:/^;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(";"+e[1]+"="+x(e[2]))}},{name:"query-parameter",pattern:/^(?:\?|&)(?::)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/},{name:"delimiter",pattern:/^(\/|\?)/,regex:function(e){return new RegExp("\\"+e[0])}},{name:"sub-delimiter",pattern:/^(!|&|-|_|\.|;)/,regex:function(e){return new RegExp(e[0])}},{name:"fragment",pattern:/^([0-9a-zA-Z]+)/,regex:function(e){return new RegExp(e[0])}}],F=function e(t,n){if(void 0===n&&(n=[]),!I.some(function(r){var a=t.match(r.pattern);return!!a&&(n.push({type:r.name,match:a[0],val:a.slice(1,2),otherVal:a.slice(2),regex:r.regex instanceof Function?r.regex(a):r.regex}),a[0].length<t.length&&(n=e(t.substr(a[0].length),n)),!0)}))throw new Error("Could not parse path '"+t+"'");return n},M=function(e){return e},U=function(e){return void 0!==e&&null!==e},$=function(e,t){return t?e:"\\/"===e?e:e.replace(/\\\/$/,"")+"(?:\\/)?"},q=function(e,t){return t?/(\/)$/.test(e)?e:e+"(\\/|\\?|\\.|;|$)":e},D=function(e,t,n){void 0===n&&(n="");var r=e[t];return e[t]=void 0===r?n:Array.isArray(r)?r.concat(n):[r,n],e},L=function(){function e(e){if(!e)throw new Error("Missing path in Path constructor");this.path=e,this.tokens=F(e),this.hasUrlParams=this.tokens.filter(function(e){return/^url-parameter/.test(e.type)}).length>0,this.hasSpatParam=this.tokens.filter(function(e){return/splat$/.test(e.type)}).length>0,this.hasMatrixParams=this.tokens.filter(function(e){return/matrix$/.test(e.type)}).length>0,this.hasQueryParams=this.tokens.filter(function(e){return/^query-parameter/.test(e.type)}).length>0,this.spatParams=this.getParams("url-parameter-splat"),this.urlParams=this.getParams(/^url-parameter/),this.queryParams=this.getParams("query-parameter"),this.params=this.urlParams.concat(this.queryParams),this.source=this.tokens.filter(function(e){return void 0!==e.regex}).map(function(e){return e.regex.source}).join("")}return e.createPath=function(t){return new e(t)},e.prototype.isQueryParam=function(e){return-1!==this.queryParams.indexOf(e)},e.prototype.test=function(e,t){var n=this,r=j({strictTrailingSlash:!1,queryParams:{}},t),a=$(this.source,r.strictTrailingSlash),o=this.urlTest(e,a+(this.hasQueryParams?"(\\?.*$|$)":"$"),t);if(!o||!this.hasQueryParams)return o;var i=w(e,r.queryParams);return 0===Object.keys(i).filter(function(e){return!n.isQueryParam(e)}).length?(Object.keys(i).forEach(function(e){return o[e]=i[e]}),o):null},e.prototype.partialTest=function(e,t){var n=this,r=j({delimited:!0,queryParams:{}},t),a=q(this.source,r.delimited),o=this.urlTest(e,a,r);if(!o)return o;if(!this.hasQueryParams)return o;var i=w(e,r.queryParams);return Object.keys(i).filter(function(e){return n.isQueryParam(e)}).forEach(function(e){return D(o,e,i[e])}),o},e.prototype.build=function(e,t){var n=this;void 0===e&&(e={});var r=j({ignoreConstraints:!1,ignoreSearch:!1,queryParams:{}},t),a=Object.keys(e).filter(function(e){return!n.isQueryParam(e)}).reduce(function(t,r){if(!U(e[r]))return t;var a=e[r],o=n.isQueryParam(r)?M:encodeURI;return"boolean"==typeof a?t[r]=a:Array.isArray(a)?t[r]=a.map(o):t[r]=o(a),t},{});if(this.urlParams.some(function(t){return!U(e[t])})){var o=this.urlParams.filter(function(t){return!U(e[t])});throw new Error("Cannot build path: '"+this.path+"' requires missing parameters { "+o.join(", ")+" }")}if(!r.ignoreConstraints&&!this.tokens.filter(function(e){return/^url-parameter/.test(e.type)&&!/-splat$/.test(e.type)}).every(function(e){return new RegExp("^"+x(e.otherVal[0])+"$").test(a[e.val])}))throw new Error("Some parameters of '"+this.path+"' are of invalid format");var i=this.tokens.filter(function(e){return!1===/^query-parameter/.test(e.type)}).map(function(e){return"url-parameter-matrix"===e.type?";"+e.val+"="+a[e.val[0]]:/^url-parameter/.test(e.type)?a[e.val[0]]:e.match}).join("");if(r.ignoreSearch)return i;var u=this.queryParams.filter(function(t){return-1!==Object.keys(e).indexOf(t)}).reduce(function(t,n){return t[n]=e[n],t},{}),s=C(u,r.queryParams);return s?i+"?"+s:i},e.prototype.getParams=function(e){var t=e instanceof RegExp?function(t){return e.test(t.type)}:function(t){return t.type===e};return this.tokens.filter(t).map(function(e){return e.val[0]})},e.prototype.urlTest=function(e,t,n){var r=this,a=(void 0===n?{}:n).caseSensitive,o=void 0!==a&&a,i=new RegExp("^"+t,o?"":"i"),u=e.match(i);return u?this.urlParams.length?u.slice(1,this.urlParams.length+1).reduce(function(e,t,n){return e[r.urlParams[n]]=decodeURIComponent(t),e},{}):{}:null},e}(),z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Z=function(){function e(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),K=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},V=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},W=function(e){var t="";return e.reduce(function(e,n){var r=n.parser.urlParams.reduce(function(e,t){return e[t]="url",e},{}),a=n.parser.queryParams.reduce(function(e,t){return e[t]="query",e},r);return void 0!==n.name&&(e[t=t?t+"."+n.name:n.name]=a),e},{})},G=function(e){return e&&e.segments&&e.segments.length?{name:e.segments.map(function(e){return e.name}).filter(function(e){return e}).join("."),params:e.params,meta:W(e.segments)}:null},H=function(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n={}),!e)return null;for(var r=n.queryParamsMode,a=void 0===r?"default":r,o=(n.trailingSlashMode,[]),i=[],u=0,s=e;u<s.length;u++){var c=s[u].parser;o.push.apply(o,c.queryParams),i.push.apply(i,c.urlParams),i.push.apply(i,c.spatParams)}if("loose"===a){var l=Object.keys(t).reduce(function(e,t){return-1===o.indexOf(t)&&-1===i.indexOf(t)?e.concat(t):e},[]);o.push.apply(o,l)}var f=o.reduce(function(e,n){return-1!==Object.keys(t).indexOf(n)&&(e[n]=t[n]),e},{}),d=C(f),p=e.reduce(function(e,r){var a=r.parser.build(t,{ignoreSearch:!0,queryParams:n.queryParams});return r.absolute?a:e+a},"").replace(/\/\/{1,}/g,"/"),h=p;return"always"===n.trailingSlashMode?h=/\/$/.test(p)?p:p+"/":"never"===n.trailingSlashMode&&"/"!==p&&(h=/\/$/.test(p)?p.slice(0,-1):p),h+(d?"?"+d:"")},Y=function(e){return e?e.map(function(e){return e.path}).join(""):null},J=function(e){return e.split("?")[0]},X=function(e){return e.split("?")[1]||""},ee=function e(t,n,r,a,o){void 0===a&&(a={});for(var i=a.queryParamsMode,u=void 0===i?"default":i,s=a.strictTrailingSlash,c=void 0!==s&&s,l=a.strongMatching,f=void 0===l||l,d=1===t.length&&""===t[0].name,p=0,h=t;p<h.length;p++){var m=function(t){var i,s=void 0,l=n;if("/"===o&&"/"===t.path&&(l="/"+n),t.children.length||(i=t.parser.test(l,a)),i||(i=t.parser.partialTest(l,{delimited:f})),i){var p=t.parser.build(i,{ignoreSearch:!0});c||t.children.length||(p=p.replace(/\/$/,"")),s=l.replace(p,""),c||t.children.length||(s=s.replace(/^\/\?/,"?"));var h=k(X(l.replace(p,"")),t.parser.queryParams).querystring;if(s=J(s)+(h?"?"+h:""),c||d||"/"!==s||/\/$/.test(p)||(s=""),r.segments.push(t),Object.keys(i).forEach(function(e){return r.params[e]=i[e]}),!d&&!s.length)return{value:r};if(!d&&"strict"!==u&&0===s.indexOf("?")){var m=w(s.slice(1));return Object.keys(m).forEach(function(e){return r.params[e]=m[e]}),{value:r}}var v=t.getNonAbsoluteChildren();return v.length?{value:e(v,s,r,a,p)}:{value:null}}}(h[p]);if("object"===(void 0===m?"undefined":z(m)))return m.value}return null},te=function(e){return function(t,n){var r=t.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1"),a=n.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1");if("/"===r)return 1;if("/"===a)return-1;if(t.parser.hasSpatParam)return 1;if(n.parser.hasSpatParam)return-1;var o=(r.match(/\//g)||[]).length,i=(a.match(/\//g)||[]).length;if(o<i)return 1;if(o>i)return-1;var u=t.parser.urlParams.length,s=n.parser.urlParams.length;if(u<s)return-1;if(u>s)return 1;var c=(r.split("/").slice(-1)[0]||"").length,l=(a.split("/").slice(-1)[0]||"").length;return c<l?1:c>l?-1:e.indexOf(t)-e.indexOf(n)}},ne=(V({},{queryParamsMode:"default",trailingSlashMode:"default"},{strongMatching:!0}),function(){function e(e,t,n,r,a){return void 0===e&&(e=""),void 0===t&&(t=""),void 0===n&&(n=[]),this.name=e,this.absolute=/^~/.test(t),this.path=this.absolute?t.slice(1):t,this.parser=this.path?new L(this.path):null,this.children=[],this.parent=a,this.checkParents(),this.add(n,r),this}return e.prototype.getParentSegments=function(e){return void 0===e&&(e=[]),this.parent&&this.parent.parser?this.parent.getParentSegments(e.concat(this.parent)):e.reverse()},e.prototype.setParent=function(e){this.parent=e,this.checkParents()},e.prototype.setPath=function(e){void 0===e&&(e=""),this.path=e,this.parser=e?new L(e):null},e.prototype.add=function(t,n){var r=this;if(void 0!==t&&null!==t){if(!(t instanceof Array)){if(!(t instanceof e||t instanceof Object))throw new Error("RouteNode.add() expects routes to be an Object or an instance of RouteNode.");if(t instanceof e)t.setParent(this),this.addRouteNode(t);else{if(!t.name||!t.path)throw new Error("RouteNode.add() expects routes to have a name and a path defined.");var a=new e(t.name,t.path,t.children,n,this),o=a.getParentSegments([a]).map(function(e){return e.name}).join(".");n&&n(V({},t,{name:o})),this.addRouteNode(a)}return this}t.forEach(function(e){return r.add(e,n)})}},e.prototype.addNode=function(t,n){return this.add(new e(t,n)),this},e.prototype.getPath=function(e){return Y(this.getSegmentsByName(e))},e.prototype.getNonAbsoluteChildren=function(){return this.children.filter(function(e){return!e.absolute})},e.prototype.buildPath=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n={}),H(this.getSegmentsByName(e),t,n)},e.prototype.buildState=function(e,t){void 0===t&&(t={});var n=this.getSegmentsByName(e);return n&&n.length?{name:e,params:t,meta:W(n)}:null},e.prototype.matchPath=function(e,t){void 0===t&&(t={}),""!==e||t.strictTrailingSlash||(e="/");var n=this.getSegmentsMatchingPath(e,t);if(n){var r=n.segments;if(r[0].absolute){var a=r[0].getParentSegments();r.reverse(),r.push.apply(r,a),r.reverse()}var o=r[r.length-1].findSlashChild();o&&r.push(o)}return G(n)},e.prototype.addRouteNode=function(e,t){var n=e.name.split(".");if(1===n.length){if(-1!==this.children.map(function(e){return e.name}).indexOf(e.name))throw new Error('Alias "'+e.name+'" is already defined in route node');if(-1!==this.children.map(function(e){return e.path}).indexOf(e.path))throw new Error('Path "'+e.path+'" is already defined in route node');this.children.push(e);var r=this.children.slice(0);this.children.sort(te(r))}else{var a=this.getSegmentsByName(n.slice(0,-1).join("."));if(!a)throw new Error("Could not add route named '"+e.name+"', parent is missing.");e.name=n[n.length-1],a[a.length-1].add(e)}return this},e.prototype.checkParents=function(){if(this.absolute&&this.hasParentsParams())throw new Error("[RouteNode] A RouteNode with an abolute path cannot have parents with route parameters")},e.prototype.hasParentsParams=function(){if(this.parent&&this.parent.parser){var e=this.parent.parser;return e.hasUrlParams||e.hasSpatParam||e.hasMatrixParams||e.hasQueryParams||this.parent.hasParentsParams()}return!1},e.prototype.findAbsoluteChildren=function(){return this.children.reduce(function(e,t){return e.concat(t.absolute?t:[]).concat(t.findAbsoluteChildren())},[])},e.prototype.findSlashChild=function(){return this.getNonAbsoluteChildren().filter(function(e){return e.parser&&/^\/(\?|$)/.test(e.parser.path)})[0]},e.prototype.getSegmentsByName=function(e){var t=function(e,t){var n=t.filter(function(t){return t.name===e});return n.length?n[0]:void 0},n=[],r=this.parser?[this]:this.children;return(this.parser?[""]:[]).concat(e.split(".")).every(function(e){var a=t(e,r);return!!a&&(r=a.children,n.push(a),!0)})?n:null},e.prototype.getSegmentsMatchingPath=function(e,t){var n=(this.parser?[this]:this.children).reduce(function(e,t){return e.concat(t,t.findAbsoluteChildren())},[]),r=ee(n,e,{segments:[],params:{}},t);return r&&1===r.segments.length&&""===r.segments[0].name?null:r},e}()),re={ROUTER_NOT_STARTED:"NOT_STARTED",NO_START_PATH_OR_STATE:"NO_START_PATH_OR_STATE",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",TRANSITION_CANCELLED:"CANCELLED"},ae={UNKNOWN_ROUTE:"@@router5/UNKNOWN_ROUTE",ROUTER_START:"$start",ROUTER_STOP:"$stop",TRANSITION_START:"$$start",TRANSITION_CANCEL:"$$cancel",TRANSITION_SUCCESS:"$$success",TRANSITION_ERROR:"$$error"},oe=function(){},ie="function"==typeof Symbol&&"symbol"===z(Symbol.iterator)?function(e){return void 0===e?"undefined":z(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":z(e)},ue=function(){},se=["onStart","onStop","onTransitionSuccess","onTransitionStart","onTransitionError","onTransitionCancel"],ce=function(e){return"function"==typeof e?e:function(){return function(){return e}}},le={trailingSlashMode:"default",queryParamsMode:"default",strictTrailingSlash:!1,autoCleanUp:!0,allowNotFound:!1,strongMatching:!0,rewritePathOnMatch:!0},fe=function(){};v.pluginName="LOGGER_PLUGIN",e.default=m,e.createRouter=m,e.RouteNode=ne,e.loggerPlugin=v,e.errorCodes=re,e.transitionPath=u,e.constants=ae,Object.defineProperty(e,"__esModule",{value:!0})});
