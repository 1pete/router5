/**
 * @license
 * @version 0.9.0
 * The MIT License (MIT)
 * 
 * Copyright (c) 2015 Thomas Roch
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
(function(t){var e=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(t,r.key,r)}}return function(e,n,r){if(n)t(e.prototype,n);if(r)t(e,r);return e}}();function n(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var r=function r(t){return"("+(t?t.replace(/(^<|>$)/g,""):"[a-zA-Z0-9-_.~]+")+")"};var a=[{name:"url-parameter",pattern:/^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function i(t){return new RegExp(r(t[2]))}},{name:"url-parameter-splat",pattern:/^\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,regex:/([^\?]*)/},{name:"url-parameter-matrix",pattern:/^\;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function i(t){return new RegExp(";"+t[1]+"="+r(t[2]))}},{name:"query-parameter",pattern:/^(?:\?|&)(?:\:)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/},{name:"delimiter",pattern:/^(\/|\?)/,regex:function i(t){return new RegExp("\\"+t[0])}},{name:"sub-delimiter",pattern:/^(\!|\&|\-|_|\.|;)/,regex:function i(t){return new RegExp(t[0])}},{name:"fragment",pattern:/^([0-9a-zA-Z]+?)/,regex:function i(t){return new RegExp(t[0])}}];var u=function u(t){var e=arguments.length<=1||arguments[1]===undefined?[]:arguments[1];var n=a.some(function(n){var r=t.match(n.pattern);if(!r)return false;e.push({type:n.name,match:r[0],val:r.slice(1,2),otherVal:r.slice(2),regex:n.regex instanceof Function?n.regex(r):n.regex});if(r[0].length<t.length)e=u(t.substr(r[0].length),e);return true});if(!n){throw new Error("Could not parse path.")}return e};var s=function s(t,e){if(!e)return t;return t.replace(/\\\/$/,"")+"(?:\\/)?"};var o=function o(t,e){var n=arguments.length<=2||arguments[2]===undefined?"":arguments[2];var r=t[e];if(r===undefined)t[e]=n;else t[e]=Array.isArray(r)?r.concat(n):[r,n];return t};var l=function l(t){var e=t.split("?")[1];if(!e)return{};return e.split("&").map(function(t){return t.split("=")}).reduce(function(t,e){return o(t,e[0],e[1])},{})};var f=function f(t){return t!==undefined&&t!==null&&t!==""?"="+t:""};var c=function c(t,e){return Array.isArray(e)?e.map(function(e){return c(t,e)}).join("&"):t+f(e)};var h=function(){e(i,null,[{key:"createPath",value:function t(t){return new i(t)}},{key:"serialise",value:function a(t,e){return c(t,e)}}]);function i(t){n(this,i);if(!t)throw new Error("Please supply a path");this.path=t;this.tokens=u(t);this.hasUrlParams=this.tokens.filter(function(t){return/^url-parameter/.test(t.type)}).length>0;this.hasSpatParam=this.tokens.filter(function(t){return/splat$/.test(t.type)}).length>0;this.hasMatrixParams=this.tokens.filter(function(t){return/matrix$/.test(t.type)}).length>0;this.hasQueryParams=this.tokens.filter(function(t){return t.type==="query-parameter"}).length>0;this.urlParams=!this.hasUrlParams?[]:this.tokens.filter(function(t){return/^url-parameter/.test(t.type)}).map(function(t){return t.val.slice(0,1)}).reduce(function(t,e){return t.concat(e)});this.queryParams=!this.hasQueryParams?[]:this.tokens.filter(function(t){return t.type==="query-parameter"}).map(function(t){return t.val}).reduce(function(t,e){return t.concat(e)});this.params=this.urlParams.concat(this.queryParams);this.source=this.tokens.filter(function(t){return t.regex!==undefined}).map(function(t){return t.regex.source}).join("")}e(i,[{key:"_urlMatch",value:function f(t,e){var n=this;var r=t.match(e);if(!r)return null;else if(!this.urlParams.length)return{};return r.slice(1,this.urlParams.length+1).reduce(function(t,e,r){t[n.urlParams[r]]=e;return t},{})}},{key:"match",value:function h(t){var e=this;var n=arguments.length<=1||arguments[1]===undefined?0:arguments[1];var r=s(this.source,n);var a=this._urlMatch(t,new RegExp("^"+r+(this.hasQueryParams?"\\?.*$":"$")));if(!a||!this.hasQueryParams)return a;var i=l(t);var u=Object.keys(i).filter(function(t){return e.queryParams.indexOf(t)===-1});if(u.length===0){Object.keys(i).forEach(function(t){return a[t]=i[t]});return a}return null}},{key:"partialMatch",value:function v(t){var e=this;var n=arguments.length<=1||arguments[1]===undefined?0:arguments[1];var r=s(this.source,n);var a=this._urlMatch(t,new RegExp("^"+r));if(!a)return a;if(!this.hasQueryParams)return a;var i=l(t);Object.keys(i).filter(function(t){return e.queryParams.indexOf(t)>=0}).forEach(function(t){return o(a,t,i[t])});return a}},{key:"build",value:function m(){var t=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var e=arguments.length<=1||arguments[1]===undefined?{ignoreConstraints:false,ignoreSearch:false}:arguments[1];if(this.urlParams.some(function(e){return t[e]===undefined}))throw new Error("Missing parameters");if(!e.ignoreConstraints){var n=this.tokens.filter(function(t){return/^url-parameter/.test(t.type)&&!/-splat$/.test(t.type)}).every(function(e){return new RegExp("^"+r(e.otherVal[0])+"$").test(t[e.val])});if(!n)throw new Error("Some parameters are of invalid format")}var a=this.tokens.filter(function(t){return t.type!=="query-parameter"}).map(function(e){if(e.type==="url-parameter-matrix")return";"+e.val[0]+"="+t[e.val[0]];return/^url-parameter/.test(e.type)?t[e.val[0]]:e.match}).join("");if(e.ignoreSearch)return a;var i=this.queryParams.filter(function(e){return Object.keys(t).indexOf(e)!==-1}).map(function(e){return c(e,t[e])}).join("&");return a+(i?"?"+i:"")}}]);return i}();var v=function(){function t(t,e){var n=[];var r=true;var a=false;var i=undefined;try{for(var u=t[Symbol.iterator](),s;!(r=(s=u.next()).done);r=true){n.push(s.value);if(e&&n.length===e)break}}catch(o){a=true;i=o}finally{try{if(!r&&u["return"])u["return"]()}finally{if(a)throw i}}return n}return function(e,n){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return t(e,n)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var m=function m(t){return t!==undefined&&t!==null&&t!==""};var p=function p(t,e){if(t.indexOf("?")===-1)return t;var n=t.split("?");var r=v(n,2);var a=r[0];var i=r[1];var u=i.split("&").reduce(function(t,n){var r=n.split("=");var a=v(r,2);var i=a[0];var u=a[1];if(e.indexOf(i)===-1)t[i]=u||"";return t},{});var s=Object.keys(u).map(function(t){return[t].concat(m(u[t])?u[t]:[])}).map(function(t){return t.join("=")}).join("&");return a+(s?"?"+s:"")};var d=function(){function t(){var e=arguments.length<=0||arguments[0]===undefined?"":arguments[0];var r=arguments.length<=1||arguments[1]===undefined?"":arguments[1];var a=arguments.length<=2||arguments[2]===undefined?[]:arguments[2];n(this,t);this.name=e;this.path=r;this.parser=r?new h(r):null;this.children=[];this.add(a);return this}e(t,[{key:"add",value:function r(e){var n=this;if(e===undefined||e===null)return;if(e instanceof Array){e.forEach(function(t){return n.add(t)});return}if(!(e instanceof t)&&!(e instanceof Object)){throw new Error("RouteNode.add() expects routes to be an Object or an instance of RouteNode.")}if(e instanceof Object){if(!e.name||!e.path){throw new Error("RouteNode.add() expects routes to have a name and a path defined.")}e=new t(e.name,e.path,e.children)}if(this.children.map(function(t){return t.name}).indexOf(e.name)!==-1){throw new Error('Alias "'+e.name+'" is already defined in route node')}if(this.children.map(function(t){return t.path}).indexOf(e.path)!==-1){throw new Error('Path "'+e.path+'" is already defined in route node')}var r=e.name.split(".");if(r.length===1){this.children.push(e);this.children.sort(function(t,e){if(t.path==="/")return 1;if(e.path==="/")return-1;var n=t.parser.hasUrlParams||t.parser.hasSpatParam;var r=e.parser.hasUrlParams||e.parser.hasSpatParam;if(!n&&!r){return t.path&&e.path?t.path.length<e.path.length?1:-1:0}if(n&&!r)return 1;if(!n&&r)return-1;if(!t.parser.hasSpatParam&&e.parser.hasSpatParam)return-1;if(!e.parser.hasSpatParam&&t.parser.hasSpatParam)return 1;var a=(t.path.match(/\//g)||[]).length;var i=(e.path.match(/\//g)||[]).length;if(a<i)return 1;return 0})}else{var a=this.getSegmentsByName(r.slice(0,-1).join("."));if(a){a[a.length-1].add(new t(r[r.length-1],e.path,e.children))}else{throw new Error("Could not add route named '"+e.name+"', parent is missing.")}}return this}},{key:"addNode",value:function a(e,n){this.add(new t(e,n));return this}},{key:"getSegmentsByName",value:function i(t){var e=function e(t,e){var n=e.filter(function(e){return e.name===t});return n.length?n[0]:undefined};var n=[];var r=t.split(".");var a=this.children;var i=r.every(function(t){var r=e(t,a);if(r){a=r.children;n.push(r);return true}return false});return i?n:null}},{key:"getSegmentsMatchingPath",value:function u(t){var e=arguments.length<=1||arguments[1]===undefined?false:arguments[1];var n=function n(t,r,a){var i=function(i){var u=t[i];var s=u.parser.partialMatch(r);var o=undefined,l=undefined;if(!s&&e){s=u.parser.match(r,true);o=""}else if(s){var f=u.parser.build(s,{ignoreSearch:true});o=p(r.replace(f,""),u.parser.queryParams);if(e&&o==="/"&&!/\/$/.test(f)){o=""}}if(s){a.push(u);Object.keys(s).forEach(function(t){return a.params[t]=s[t]});if(!o.length){return{v:a}}if(!u.children.length){return{v:null}}return{v:n(u.children,o,a)}}};for(var u in t){var s=i(u);if(typeof s==="object")return s.v}return null};var r=this.parser?[this]:this.children;var a=[];a.params={};return n(r,t,a)}},{key:"getPathFromSegments",value:function s(t){return t?t.map(function(t){return t.path}).join(""):null}},{key:"getPath",value:function o(t){return this.getPathFromSegments(this.getSegmentsByName(t))}},{key:"buildPathFromSegments",value:function l(t){var e=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];if(!t)return null;var n=t.filter(function(t){return t.parser.hasQueryParams}).map(function(t){return t.parser.queryParams});var r=!n.length?null:n.reduce(function(t,e){return t.concat(e)}).filter(function(t){return Object.keys(e).indexOf(t)!==-1}).map(function(t){return h.serialise(t,e[t])}).join("&");return t.map(function(t){return t.parser.build(e,{ignoreSearch:true})}).join("")+(r?"?"+r:"")}},{key:"buildPath",value:function f(t){var e=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return this.buildPathFromSegments(this.getSegmentsByName(t),e)}},{key:"getMatchPathFromSegments",value:function c(t){if(!t||!t.length)return null;var e=t.map(function(t){return t.name}).join(".");var n=t.params;return{name:e,params:n}}},{key:"matchPath",value:function v(t){var e=arguments.length<=1||arguments[1]===undefined?false:arguments[1];return this.getMatchPathFromSegments(this.getSegmentsMatchingPath(t,e))}}]);return t}();var g={ROUTER_NOT_STARTED:"NOT_STARTED",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",NODE_LISTENER_ERR:"NODE_ERR",TRANSITION_CANCELLED:"CANCELLED"};var y=function y(t){return function(){return t}};var S=function S(){};var E=typeof t!=="undefined";var _=function _(){return t.location.pathname.replace(/\/$/,"")};var A=function A(e,n,r){return t.history.pushState(e,n,r)};var T=function T(e,n,r){return t.history.replaceState(e,n,r)};var w=function w(e){return t.addEventListener("popstate",e)};var P=function P(e){return t.removeEventListener("popstate",e)};var k=function k(e){var n=e.useHash?t.location.hash.replace(new RegExp("^#"+e.hashPrefix),""):t.location.pathname.replace(new RegExp("^"+e.base),"");return n+t.location.search};var b=function b(){return t.history.state};var N={};if(E){N={getBase:_,pushState:A,replaceState:T,addPopstateListener:w,removePopstateListener:P,getLocation:k,getState:b}}else{N={getBase:y(""),pushState:S,replaceState:S,addPopstateListener:S,removePopstateListener:S,getLocation:y(""),getState:y(null)}}function R(t,e,n,r,a){var i=arguments.length<=5||arguments[5]===undefined?false:arguments[5];t=t||function(){return false};var u=e||[];var s=function s(t){if(!u.length)return true;var e=u[0].length;var a=u[0](n,r,t);if(typeof a==="boolean"){t(a?null:true)}else if(a&&typeof a.then==="function"){a.then(function(){return t(null)},function(){return t(true)})}else if(e<3&&i){t(null)}return false};var o=function o(t){if(t)a(t);else{u=u.slice(1);l()}};var l=function l(){if(t()){a(null)}else{var e=s(o);if(e)a(null)}};l()}function O(t,e){var n=function n(t){return t.split(".").reduce(function(t,e){return t.concat(t.length?t[t.length-1]+"."+e:e)},[])};var r=undefined;var a=e?n(e.name):[];var i=n(t.name);var u=Math.min(a.length,i.length);if(e&&e.name===t.name)r=Math.max(u-1,0);else{for(r=0;r<u;r+=1){if(a[r]!==i[r])break}}var s=a.slice(r).reverse();var o=i.slice(r);var l=e&&r>0?a[r-1]:"";return{intersection:l,toDeactivate:s,toActivate:o}}function x(t,e,n,r){var a=false;var i=function i(){return a};var u=function u(){return a=true};var s=function s(t){return r(a?g.TRANSITION_CANCELLED:t)};var o=O(e,n);var l=o.toDeactivate;var f=o.toActivate;var c=function c(e,n,r){var a=l.map(function(e){return t._cmps[e]}).filter(function(t){return t&&t.canDeactivate}).map(function(t){return t.canDeactivate});R(i,a,e,n,function(t){return r(t?g.CANNOT_DEACTIVATE:null)})};var h=function h(e,n,r){var a=f.map(function(e){return t._canAct[e]}).filter(function(t){return t});R(i,a,e,n,function(t){return r(t?g.CANNOT_ACTIVATE:null)})};var v=t._onTr;var m=function m(t,e,n){var r=[v];R(i,r,t,e,function(t){return n(t?g.TRANSITION_ERR:null)})};var p=(n?[c]:[]).concat(h).concat(v?m:[]);R(i,p,e,n,s);return u}var v=function(){function t(t,e){var n=[];var r=true;var a=false;var i=undefined;try{for(var u=t[Symbol.iterator](),s;!(r=(s=u.next()).done);r=true){n.push(s.value);if(e&&n.length===e)break}}catch(o){a=true;i=o}finally{try{if(!r&&u["return"])u["return"]()}finally{if(a)throw i}}return n}return function(e,n){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return t(e,n)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var L=Array.prototype.slice;var e=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(t,r.key,r)}}return function(e,n,r){if(n)t(e.prototype,n);if(r)t(e,r);return e}}();function n(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var C=function C(t,e,n){return{name:t,params:e,path:n}};var D=function(){function t(e){var r=this;var a=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];n(this,t);this.started=false;this._onTr=null;this._cbs={};this._cmps={};this._canAct={};this.lastStateAttempt=null;this.lastKnownState=null;this.rootNode=e instanceof d?e:new d("","",e);this.options={useHash:false,hashPrefix:"",base:"",trailingSlash:0};Object.keys(a).forEach(function(t){return r.options[t]=a[t]});this._setBase();this.registeredPlugins={};this.boundOnPopState=this.onPopState.bind(this)}e(t,[{key:"_setBase",value:function r(){if(this.options.useHash&&!this.options.base)this.options.base=N.getBase()}},{key:"setOption",value:function a(t,e){this.options[t]=e;if(t==="useHash")this._setBase();return this}},{key:"add",value:function i(t){this.rootNode.add(t);return this}},{key:"addNode",value:function u(t,e,n){this.rootNode.addNode(t,e);if(n)this._canAct[t]=n;return this}},{key:"usePlugin",value:function s(t){var e=this;if(!t.name)console.warn("[router5.registerPlugin(plugin)] Missing property pluginName");var n=["onStart","onStop","onTransitionStart","onTransitionSuccess","onTransitionStart","onTransitionError","onTransitionCancel"];var r=n.concat("init").some(function(e){return t[e]!==undefined});if(!r)throw new Error("[router5] plugin "+t.name+" has none of the expected methods implemented");this.registeredPlugins[t.name]=t;if(t.init)t.init(this);n.forEach(function(n){if(t[n]){e._addListener(n.toLowerCase().replace(/^on/,"$"),t[n])}});return this}},{key:"onPopState",value:function o(t){var e=this;var n=!t.state||!t.state.name;var r=t.state||this.matchPath(this.getLocation());var a=this.options;if(!r){this.navigate(a.defaultRoute,a.defaultParams,{reload:true,replace:true});return}if(this.lastKnownState&&this.areStatesEqual(r,this.lastKnownState)){return}this._transition(r,this.lastKnownState,function(t,i){if(t){if(t===g.CANNOT_DEACTIVATE){var u=e.buildUrl(e.lastKnownState.name,e.lastKnownState.params);if(!n){e.updateBrowserState(r,u,true)}}else{e.navigate(a.defaultRoute,a.defaultParams,{reload:true,replace:true})}}else{e.updateBrowserState(i,e.buildUrl(i.name,i.params),n)}})}},{key:"onTransition",value:function l(t){this._onTr=t;return this}},{key:"start",value:function f(){var t=this;var e=[].concat(L.call(arguments));var n=e.slice(-1)[0];var r=n instanceof Function?n:null;var a=undefined,i=undefined;if(this.started){if(r)r(g.ROUTER_ALREADY_STARTED);return this}if(e.length>0){if(typeof e[0]==="string")a=e[0];if(typeof e[0]==="object")i=e[0]}this.started=true;this._invokeListeners("$start");var u=this.options;var s=function s(e,n){var a=arguments.length<=2||arguments[2]===undefined?true:arguments[2];N.addPopstateListener(t.boundOnPopState);if(r)r(e,n);if(e&&a)t._invokeListeners("$transitionerror",n,null,e)};if(!a&&!i)a=this.getLocation();if(!i){(function(){i=t.matchPath(a);var e=function e(){return t.navigate(u.defaultRoute,u.defaultParams,{replace:true},function(t,e){return s(t,e,false)})};if(i){t.lastStateAttempt=i;t._transition(t.lastStateAttempt,t.lastKnownState,function(n,r){if(!n){t.updateBrowserState(t.lastKnownState,t.buildUrl(i.name,i.params),true);s(null,r)}else if(u.defaultRoute)e();else s(n,null,false)})}else if(u.defaultRoute){e()}else{s(g.ROUTE_NOT_FOUND,null)}})()}else{this.lastKnownState=i;this.updateBrowserState(this.lastKnownState,this.buildUrl(i.name,i.params),true);s(null,i)}return this}},{key:"stop",value:function c(){if(!this.started)return this;this.lastKnownState=null;this.lastStateAttempt=null;this.started=false;this._invokeListeners("$stop");N.removePopstateListener(this.boundOnPopState);return this}},{key:"getState",value:function h(){return this.lastKnownState}},{key:"isActive",value:function m(t){var e=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var n=arguments.length<=2||arguments[2]===undefined?false:arguments[2];var r=arguments.length<=3||arguments[3]===undefined?true:arguments[3];var a=this.getState();if(!a)return false;if(n||a.name===t){return this.areStatesEqual(C(t,e),a,r)}return this.areStatesDescendants(C(t,e),a)}},{key:"areStatesEqual",value:function p(t,e){var n=this;var r=arguments.length<=2||arguments[2]===undefined?true:arguments[2];if(t.name!==e.name)return false;var a=function a(t){return n.rootNode.getSegmentsByName(t).map(function(t){return t.parser[r?"urlParams":"params"]}).reduce(function(t,e){return t.concat(e)},[])};var i=a(t.name);var u=a(e.name);return i.length===u.length&&i.every(function(n){return t.params[n]===e.params[n]})}},{key:"areStatesDescendants",value:function y(t,e){var n=new RegExp("^"+t.name+"\\.(.*)$");if(!n.test(e.name))return false;return Object.keys(t.params).every(function(n){return t.params[n]===e.params[n]})}},{key:"_invokeListeners",value:function S(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++){n[r-1]=arguments[r]}(this._cbs[t]||[]).forEach(function(t){return t.apply(undefined,n)})}},{key:"_addListener",value:function E(t,e,n){this._cbs[t]=(this._cbs[t]||[]).concat(e);return this}},{key:"registerComponent",value:function _(t,e){if(this._cmps[t])console.warn("A component was alread registered for route node "+t+".");this._cmps[t]=e;return this}},{key:"deregisterComponent",value:function A(t){delete this._cmps[t]}},{key:"canActivate",value:function T(t,e){this._canAct[t]=e;return this}},{key:"getLocation",value:function w(){return N.getLocation(this.options)}},{key:"buildUrl",value:function P(t,e){return this._buildUrl(this.rootNode.buildPath(t,e))}},{key:"_buildUrl",value:function k(t){return this.options.base+(this.options.useHash?"#"+this.options.hashPrefix:"")+t}},{key:"buildPath",value:function b(t,e){return this.rootNode.buildPath(t,e)}},{key:"matchPath",value:function R(t){var e=this.rootNode.matchPath(t,this.options.trailingSlash);return e?C(e.name,e.params,t):null}},{key:"urlToPath",value:function O(t){var e=t.match(/^(?:http|https)\:\/\/(?:[0-9a-z_\-\.\:]+?)(?=\/)(.*)$/);var n=e?e[1]:t;var r=n.match(/^(.*?)(#.*?)?(\?.*)?$/);if(!r)throw new Error("[router5] Could not parse url "+t);var a=r.slice(1);var i=v(a,3);var u=i[0];var s=i[1];var o=i[2];var l=this.options;return(l.useHash?s.replace(new RegExp("^#"+l.hashPrefix),""):u.replace(new RegExp("^"+l.base),""))+(o||"")}},{key:"matchUrl",value:function D(t){return this.matchPath(this.urlToPath(t))}},{key:"_transition",value:function j(t,e,n){var r=this;if(this._tr)this._tr();this._invokeListeners("$transitionstart",t,e);var a=x(this,t,e,function(a){r._tr=null;if(a){if(a===g.TRANSITION_CANCELLED)r._invokeListeners("$transitioncancel",t,e);else r._invokeListeners("$transitionerror",t,e,a);if(n)n(a);return}r.lastKnownState=t;r._invokeListeners("$transitionsuccess",t,e);if(n)n(null,t)});this._tr=a;return function(){return!a||a()}}},{key:"navigate",value:function U(t,e,n,r){if(e===undefined)e={};var a=this;if(n===undefined)n={};if(!this.started){if(r)r(g.ROUTER_NOT_STARTED);return}if(!N.getState())n.replace=true;var i=this.buildPath(t,e);var u=this.buildUrl(t,e);if(!i){if(r)r(g.ROUTE_NOT_FOUND);this._invokeListeners("$transitionerror",null,this.lastKnownState,g.ROUTE_NOT_FOUND);return}var s=C(t,e,i);this.lastStateAttempt=s;var o=this.lastKnownState?this.areStatesEqual(this.lastKnownState,this.lastStateAttempt):false;if(o&&!n.reload){if(r)r(g.SAME_STATES);this._invokeListeners("$transitionerror",s,this.lastKnownState,g.SAME_STATES);return}return this._transition(s,o?null:this.lastKnownState,function(t,e){if(t){if(r)r(t);return}a.updateBrowserState(a.lastStateAttempt,u,n.replace);if(r)r(null,e)})}},{key:"updateBrowserState",value:function $(t,e){var n=arguments.length<=2||arguments[2]===undefined?false:arguments[2];var r=arguments.length<=3||arguments[3]===undefined?"":arguments[3];N[n?"replaceState":"pushState"](t,r,e)}}]);return t}();D.ERR=g;D.transitionPath=O;var j="LISTENERS";function U(t,e){var n=function n(t){return t.split(".").reduce(function(t,e){return t.concat(t.length?t[t.length-1]+"."+e:e)},[])};var r=undefined;var a=e?n(e.name):[];var i=n(t.name);var u=Math.min(a.length,i.length);if(e&&e.name===t.name)r=Math.max(u-1,0);else{for(r=0;r<u;r+=1){if(a[r]!==i[r])break}}return e&&r>0?a[r-1]:""}function $(){var t={};function e(e){var n=function n(n,r){if(t[n])t[n]=t[n].filter(function(t){return t!==r});return e};var r=function r(n,r,a){var i=n.replace(/^(\*|\^|=)/,"");if(i&&!/^\$/.test(n)){var u=e.rootNode.getSegmentsByName(i);if(!u)console.warn("No route found for "+i+", listener might never be called!")}if(!t[n])t[n]=[];t[n]=(a?[]:t[n]).concat(r);return e};e.addListener=function(t){return r("*",t)};e.removeListener=function(t){return n("*",t)};e.addNodeListener=function(t,e){return r("^"+t,e,true)};e.removeNodeListener=function(t,e){return n("^"+t,e)};e.addRouteListener=function(t,e){return r("="+t,e)};e.removeRouteListener=function(t,e){return n("="+t,e)}}function n(e,n,r){(t[e]||[]).forEach(function(t){return t(n,r)})}function r(t,e){var r=U(t,e);var a=t.name;n("^"+r,t,e);n("="+a,t,e);n("*",t,e)}function a(){t={}}return{name:j,init:e,onTransitionSuccess:r,flush:a}}t.RouteNode=d;t.Router5=D;t.listenersPlugin=$})(window);